# TDMS: Система Управління Табличними Базами Даних

## Модуль 1, Варіант 58 - Порівняльний Аналіз Розробки

### Анотація

Дане дослідження представляє розробку та порівняльний аналіз Системи Управління Табличними Базами Даних (TDMS), реалізованої з використанням двох різних архітектурних підходів: настільного додатку та веб-рішення. Система демонструє часткову реалізацію функціональності управління реляційними базами даних з підтримкою множинних типів даних, операцій з таблицями та операцій об'єднання відповідно до академічного варіанту 58.

### Специфікація Системи

Реалізація TDMS відповідає вимогам специфікації системи Типу 1, що включає необмежену кількість таблиць, стовпців та рядків з комплексною підтримкою типів даних, включаючи базові типи (integer, real, char, string) та спеціалізовані типи (date, dateInvl). Система реалізує обов'язкові операції об'єднання для комбінування таблиць та забезпечує повне управління життєвим циклом бази даних, включаючи створення, видалення, маніпуляцію даними з валідацією та постійне зберігання через JSON серіалізацію.
image.png
## Швидкий Старт

### Початкове Налаштування

```bash
# Веб застосунок
docker compose up -d
```

```bash
# Десктопна версія
desktop.bat
```

### Структура Команд

| Дія                          | Команда                                                        | Опис                          |
| ---------------------------- | -------------------------------------------------------------- | ----------------------------- |
| **Налаштування**             | `setup_env.bat`                                                | Встановлює uv та залежності   |
| **Docker (все разом)**       | `docker compose up -d`                                         | Запускає web + redis + worker |
| **Запуск Redis (локально)**  | `docker run -d -p 6379:6379 redis:7-alpine`                    | Брокер черги                  |
| **Celery worker (локально)** | `uv run celery -A src.tasks.celery_app worker --loglevel=info` | Виконує фонові задачі         |
| **Веб-сервер**               | `uv run python run_server.py`                                  | FastAPI на порту 8000         |
| **Настільний додаток**       | `desktop.bat`                                                  | PyWebView обгортка            |
| **Тестування**               | `unit_test.bat`                                                | Запуск тестів                 |
| **Відкрити у браузері**      | `http://localhost:8000`                                        | Головна сторінка              |

## Етап 4: Порівняльний Аналіз Розробки

### Методологія Дослідження

Процес розробки слідував структурованому чотириетапному підходу: UML моделювання та проектування системи, реалізація настільного додатку з графічним інтерфейсом та комплексним тестуванням, розробка веб-базованого REST API, та порівняльний аналіз обох реалізацій. Ця методологія дозволяє систематичну оцінку архітектурних рішень та їх впливу на продуктивність системи, зручність використання та підтримуваність.

### Архітектурна Основа

Система використовує модульну трирівневу архітектуру, що складається зі спільного основного рівня, який містить бізнес-логіку та функціональність управління даними, рівня настільного клієнта, що використовує PyWebView для доставки нативного додатку, та рівня веб-сервера, що реалізує REST API через FastAPI фреймворк. Цей дизайн досягає значної повторного використання коду з 85% спільної кодової бази між реалізаціями, зберігаючи при цьому платформо-специфічні оптимізації.

### Порівняльний Аналіз Технологій

| Критерій                | Настільна Реалізація (PyWebView)      | Веб-Реалізація (FastAPI)                |
| ----------------------- | ------------------------------------- | --------------------------------------- |
| **Технологічний Стек**  | Python + PyWebView + HTML/CSS/JS      | Python + FastAPI + Jinja2 + HTML/CSS/JS |
| **Архітектура**         | Вбудований веб-сервер + Нативне вікно | Клієнт-Сервер REST API                  |
| **Розгортання**         | Автономний виконуваний файл           | Розгортання веб-сервера                 |
| **Доступність**         | Потребує локальної установки          | Мережевий доступ                        |
| **Продуктивність**      | Висока (локальні операції)            | Залежить від мережевої затримки         |
| **Безпека**             | Безпека на основі файлової системи    | Потребує аутентифікації + HTTPS         |
| **Масштабованість**     | Обмеження одним користувачем          | Багатокористувацький одночасний доступ  |
| **Підтримка Офлайн**    | Повна офлайн можливість               | Залежність від мережі                   |
| **Кросплатформність**   | Windows/Linux/macOS                   | Універсальна (на основі браузера)       |
| **Складність Розробки** | Помірна                               | Низька                                  |
| **Покриття Тестами**    | 21 тест (92% покриття)                | 29 тестів (58% покриття)                |
| **Затримка Операцій**   | 50-100мс                              | 100-200мс                               |

### Функціональні Можливості

#### Управління Базами Даних

- Створення, видалення та перейменування баз даних
- Перемикання між множинними базами даних
- Автоматичне збереження змін
- Сортування за датою модифікації
- Обробка дублікатів імен з суфіксами (1), (2)

#### Операції з Таблицями

- Створення таблиць з користувацькими схемами
- Підтримка типів даних: integer, real, char, string, date, dateInvl
- Валідація та нормалізація типів даних
- Операції об'єднання з перевіркою сумісності схем

#### Управління Рядками

- Вставка нових рядків з валідацією
- Редагування існуючих рядків з підтримкою всіх типів даних
- Видалення рядків з підтвердженням
- Спеціальна підтримка редагування дат та інтервалів дат

#### Інтеграція Google Drive

- Автентифікація через Google OAuth 2.0
- Завантаження баз даних з Google Drive
- Збереження баз даних в Google Drive
- Стандартний Google Picker для вибору файлів
- Автоматична авторизація при необхідності

#### Синхронізація з Drive (Celery + Redis)

- Кнопка "Sync Drive" на сторінці баз даних вмикає/вимикає авто-синхронізацію для конкретної бази.
- FastAPI зберігає зміни відразу у `databases/<DB>.json` та публікує першу задачу у чергу.
- Redis використовується як брокер і невелике сховище стану:
  - `tdms:sync:token:<DB>` — токен активної сесії синхронізації (видаляється при Unsync)
  - `tdms:sync:last_sync:<DB>` — останній mtime файлу, який було синхронізовано
  - `tdms:sync:lock:<DB>` — короткочасний замок від паралельних запусків
- Celery worker виконує задачу `tdms.sync_loop` і самопереплановує наступний запуск через 5 сек (вбудований `countdown`).
- На кожній ітерації worker читає локальний JSON з диска, порівнює mtime з `last_sync` і, якщо є зміни, завантажує у Google Drive та оновлює `last_sync`.
- "Unsync" видаляє токен — наступний запуск побачить відсутність токена і припинить цикл.

API:

- `POST /api/databases/{db}/sync/start` — увімкнути авто-синхронізацію (потребує `secrets/token.json`)
- `POST /api/databases/{db}/sync/stop` — вимкнути авто-синхронізацію
- `GET  /api/databases/{db}/sync/status` — статус синхронізації і час останнього успішного завантаження

### Тестування та Валідація

Система включає комплексне тестування з 102 модульними тестами, досягаючи 96% успішності проходження та 73% покриття коду. Основні модулі демонструють 100% покриття тестами, забезпечуючи надійність спільної бізнес-логіки.

#### Розподіл Тестів

- **Основна функціональність**: 36 тестів (100% покриття)
- **Настільний API**: 21 тест (92% покриття)
- **Веб-API**: 29 тестів (58% покриття)
- **Інтеграційні тести**: 16 тестів

### Системні Вимоги

#### Мінімальні Вимоги

- **Python**: 3.10 або вище
- **uv**: Пакетний менеджер (замість venv/pip)
- **Операційна система**: Windows 10/11, Linux, macOS
- **Пам'ять**: 512 МБ RAM
- **Дисковий простір**: 100 МБ

#### Залежності

- **FastAPI**: Веб-фреймворк та REST API
- **PyWebView**: Нативні вікна для настільного додатку
- **Uvicorn**: ASGI сервер для веб-додатку
- **python-dotenv**: Управління конфігурацією

### Структура Проекту

```
TDMS/
├── setup_env.bat              # Налаштування середовища
├── desktop.bat                # Запуск настільного додатку
├── run_server.py              # Запуск веб-сервера
├── Dockerfile                 # Образ для web/worker
├── docker-compose.yml         # Оркестрація web + redis + worker
├── unit_test.bat             # Виконання тестів
├── pyproject.toml            # Конфігурація проекту та залежності (uv)
├── uv.lock                   # Заблоковані версії залежностей
├── .env                      # Конфігурація
├── src/
│   ├── core/                 # Спільна бізнес-логіка (100% покриття)
│   │   ├── database.py       # Управління базою даних
│   │   ├── table.py          # Операції з таблицями
│   │   ├── row.py            # Управління рядками
│   │   ├── column.py         # Визначення стовпців
│   │   ├── validator.py      # Валідація типів даних
│   │   └── operations.py     # Операції об'єднання
│   ├── desktop/
│   │   ├── simple_app.py     # PyWebView обгортка
│   │   └── app.py            # Настільний API
│   └── web/
│       ├── main.py           # FastAPI додаток
│       └── templates/        # Jinja2 шаблони
│   ├── tasks/                 # Фонові задачі Celery
│   │   ├── __init__.py
│   │   ├── celery_app.py      # Конфігурація Celery (Redis як брокер)
│   │   └── sync_tasks.py      # Самоперепланована задача синхронізації
│   └── services/
│       └── drive_service.py   # Завантаження/оновлення файлів у Google Drive
├── tests/                    # Комплексний набір тестів (102 тести)
├── docs/
│   ├── uml/                  # UML діаграми (10 діаграм)
│   └── report.md             # Технічний звіт
├── databases/                # Локальне сховище JSON (джерело істини)
└── desktop_databases/        # Дані настільного додатку

### Запуск у Браузері / Стан репозиторію

- Веб-застосунок: `http://localhost:8000` (Docker або локально через `uv run`), UI містить кнопку "Sync Drive"/"Unsync Drive".
- `setup_env.bat`, `desktop.bat`, `unit_test.bat` оновлені під `uv` і працюють.
- Репозиторій містить повний код для web/desktop, Celery та Docker-оркестрації. Для синхронізації необхідний валідний `secrets/token.json` (OAuth користувача) або власний механізм автентифікації.
```

### Рекомендація Оптимальної Технології

**Академічні Контексти**: Настільна реалізація забезпечує швидкість розробки та спрощені можливості демонстрації, що робить її ідеальною для освітніх середовищ.

**Виробничі Контексти**: Веб-реалізація пропонує масштабованість та можливості багатокористувацької співпраці, необхідні для організаційного розгортання.

**Гібридний Підхід**: Поточна реалізація TDMS представляє оптимальне гібридне рішення, що поєднує переваги обох парадигм через спільну кодову базу та модульну архітектуру.

### Документація

#### UML Діаграми

Система включає 10 комплексних UML діаграм, що відображають поточну функціональність:

- Діаграма випадків використання
- Класова діаграма
- Діаграми послідовностей (вставка, об'єднання, Google Drive, редагування)
- Діаграма активності
- Діаграма станів
- Компонентна діаграма
- Діаграма розгортання

#### Генерація Діаграм

```bash
# Встановлення Mermaid CLI
npm install -g @mermaid-js/mermaid-cli

# Генерація всіх діаграм
cd docs/uml
export_uml.bat          # Windows
python generate_diagrams.py  # Linux/macOS
```

### Висновок

Реалізація TDMS успішно демонструє життєздатність розробки багатопарадигмальної системи баз даних через модульний дизайн. Порівняльний аналіз виявляє переваги кожного підходу та потенціал гібридних рішень. Комплексний фреймворк тестування та високе покриття коду забезпечують надійність системи для академічних та практичних застосувань.

Система готова для академічної оцінки, практичного використання та подальшого розвитку з можливістю розширення функціональності через модульну архітектуру.
