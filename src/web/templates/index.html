<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>TDMS DBMS - Variant 58</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      input,
      select,
      button,
      textarea {
        margin: 4px;
      }
      pre {
        background: #f5f5f5;
        padding: 8px;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .col {
        display: inline-block;
        margin-right: 8px;
      }
    </style>
    <script>
      async function createTable() {
        const name = document.getElementById("tname").value;
        const schemaText = document.getElementById("schema").value;
        const schema = JSON.parse(schemaText);
        const res = await fetch("/create_table", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, schema }),
        });
        alert(await res.text());
        location.reload();
      }
      async function insertRow() {
        const table = document.getElementById("rtname").value;
        const values = JSON.parse(document.getElementById("values").value);
        const res = await fetch("/insert_row", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ table, values }),
        });
        alert(await res.text());
        location.reload();
      }
      async function unionTables() {
        const left = document.getElementById("left").value;
        const right = document.getElementById("right").value;
        const res = await fetch("/union", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ left, right }),
        });
        alert(await res.text());
        location.reload();
      }
    </script>
  </head>
  <body>
    <h1>TDMS DBMS - Variant 58</h1>

    <h2>Create Table</h2>
    <div>
      <input id="tname" placeholder="table name" />
      <textarea
        id="schema"
        rows="3"
        cols="60"
        placeholder='[ {"name":"id","type":"integer"} ]'
      ></textarea>
      <button onclick="createTable()">Create</button>
    </div>

    <h2>Insert Row</h2>
    <div>
      <input id="rtname" placeholder="table name" />
      <textarea
        id="values"
        rows="3"
        cols="60"
        placeholder='{"id":1}'
      ></textarea>
      <button onclick="insertRow()">Insert</button>
    </div>

    <h2>Union</h2>
    <div>
      <input id="left" placeholder="left table" />
      <input id="right" placeholder="right table" />
      <button onclick="unionTables()">Union</button>
    </div>

    <h2>Tables</h2>
    {% for t in tables %}
    <h3>{{ t.name }}</h3>
    <div class="row">
      <div class="col"><strong>Schema:</strong></div>
      <div>
        {% for c in t.columns %}
        <span class="col">{{ c.name }}: {{ c.type }}</span>
        {% endfor %}
      </div>
    </div>
    <pre>{{ t.rows | tojson(indent=2) }}</pre>
    {% endfor %}
  </body>
</html>
