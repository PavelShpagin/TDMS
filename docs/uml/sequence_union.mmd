sequenceDiagram
    autonumber
    participant U as User
    participant UI as Web/Desktop UI
    participant API as FastAPI/Desktop API
    participant DB as Database
    participant OP as Operations
    participant T1 as Table A
    participant T2 as Table B
    participant RT as Result Table
    participant FS as File System

    Note over U,FS: Table Union Operation with Schema Validation

    U->>UI: Select tables A & B, click "Union"
    UI->>API: POST /union {left: "A", right: "B", name: "A_UNION_B"}
    API->>DB: get_table("A")
    DB-->>API: Table A
    API->>DB: get_table("B") 
    DB-->>API: Table B
    
    API->>OP: union_tables(Table A, Table B)
    
    Note over OP,RT: Schema Compatibility Check
    OP->>T1: get schema
    T1-->>OP: [(id, integer), (name, string)]
    OP->>T2: get schema
    T2-->>OP: [(id, integer), (email, string)]
    
    alt Compatible Schemas
        OP->>RT: create combined schema
        OP->>T1: get all rows
        T1-->>OP: rows data
        OP->>T2: get all rows  
        T2-->>OP: rows data
        OP->>RT: append all rows with null padding
        OP-->>API: Result Table
        
        API->>DB: add_table(Result Table)
        API->>FS: auto_save_database()
        FS-->>API: saved
        API-->>UI: {"name": "A_UNION_B", "rows": [...]}
        UI-->>U: "Union completed: A_UNION_B created"
        
    else Incompatible Schemas
        OP-->>API: SchemaError("column type mismatch")
        API-->>UI: {"error": "incompatible schemas"}
        UI-->>U: "Cannot union: incompatible column types"
    end