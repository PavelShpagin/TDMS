sequenceDiagram
    autonumber
    participant U as User
    participant UI as Web/Desktop UI
    participant Modal as Edit Modal
    participant API as FastAPI/Desktop API
    participant DB as Database
    participant T as Table
    participant V as TypeValidator
    participant FS as File System

    Note over U,FS: Row Editing with Date/DateInvl Support

    U->>UI: Click "Edit" button on table row
    UI->>Modal: Show edit modal with current values
    Modal->>Modal: Populate form fields
    
    Note over Modal: Special handling for date types
    Modal->>Modal: Set input type="date" for date columns
    Modal->>Modal: Format dateInvl as "start → end"
    
    Modal-->>U: Display edit form
    U->>Modal: Modify values and click "Save"
    
    Modal->>Modal: Validate form inputs
    
    alt Date Column
        Modal->>Modal: Validate YYYY-MM-DD format
    else DateInvl Column
        Modal->>Modal: Parse "start → end" format
        Modal->>Modal: Create {start: "date1", end: "date2"}
    else Other Types
        Modal->>Modal: Use raw input value
    end
    
    Modal->>API: POST /update_row {table, row_index, values}
    API->>DB: get_table(table_name)
    DB-->>API: Table instance
    API->>T: Check row_index bounds
    
    alt Valid Index
        T->>V: validate_row(schema, new_values)
        
        alt Valid Data
            V-->>T: normalized_values
            T->>T: rows[row_index] = normalized_values
            T-->>API: success
            API->>FS: auto_save_database()
            FS-->>API: saved
            API-->>UI: {"status": "ok"}
            UI->>Modal: Close modal
            UI->>UI: Refresh table display
            UI-->>U: "Row updated successfully"
            
        else Invalid Data
            V-->>T: ValidationError
            T-->>API: validation error
            API-->>UI: {"error": "Invalid data format"}
            UI-->>U: "Validation failed - check data types"
        end
        
    else Invalid Index
        API-->>UI: {"error": "Invalid row index"}
        UI-->>U: "Row not found - table may have changed"
    end
