@startuml class_full_system
!theme plain
title TDMS - Complete System Class Diagram

package "Core" #LightBlue {
  class Database {
    - name: str
    - tables: Dict[str, Table]
    + create_table(name, schema): Table
    + drop_table(name): void
    + get_table(name): Table
    + insert_row(table, values): void
    + save(path): void
    + load(path): Database
    + to_json(): Dict
  }
  
  class Table {
    - name: str
    - columns: List[Column]
    - rows: List[Row]
    + add_row(values): Row
    + get_rows(): List[Dict]
    + schema_signature(): Tuple
  }
  
  class TypeValidator {
    + validate_row(schema, values): Dict
    + normalize_date(value): str
    + normalize_dateInvl(value): Dict
  }
  
  class Operations {
    + union_tables(t1, t2): Table
  }
}

package "Web API" #LightGreen {
  class FastAPIApp {
    - app: FastAPI
    - _db_registry: Dict
    - _active_db_name: str
    + create_database(name): Dict
    + create_table(payload): Dict
    + insert_row(payload): Dict
    + union_tables(payload): Dict
    + save_drive(payload): Dict
    + load_drive(payload): Dict
    + list_drive_files(): List
  }
  
  class DriveService {
    - service_account: Module
    - build: Function
    + _get_drive_service(): Service
    + upload_json(content): str
    + download_json(file_id): Dict
  }
}

package "Desktop" #LightYellow {
  class DesktopApp {
    - window: WebViewWindow
    - server_thread: Thread
    + start_server(): void
    + run(): void
  }
}

' Core relationships
Database "1" *-- "*" Table
Table ..> TypeValidator
Operations ..> Table

' API relationships  
FastAPIApp --> Database
FastAPIApp --> DriveService
DriveService ..> "Google Drive" : API v3

' Desktop relationships
DesktopApp --> FastAPIApp : embeds

note bottom of TypeValidator
  Variant 58:
  date, dateInvl
end note

note right of Operations
  Variant 58:
  union operation
end note

@enduml