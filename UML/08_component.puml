@startuml component
!theme plain
title TDMS - Component Diagram with Google Drive Integration

package "TDMS System" {
  
  package "Presentation Layer" {
    component [Web UI] <<HTML/CSS/JS>> {
      port "HTTP" as web_port
    }
    
    component [Desktop UI] <<PyWebView>> {
      port "Embedded" as desktop_port
    }
  }
  
  package "Application Layer" {
    component [FastAPI Server] <<Web Service>> {
      port "REST API" as rest_api
    }
    
    component [API Endpoints] <<Controllers>> {
      port "Handlers" as handlers
    }
  }
  
  package "Business Logic" {
    component [Core Module] <<Domain>> {
      port "DB Ops" as db_ops
      port "Validation" as validation
    }
    
    component [Database] <<Entity>>
    component [Table] <<Entity>>
    component [TypeValidator] <<Service>>
    component [Operations] <<Service>>
  }
  
  package "Persistence Layer" {
    component [Local Storage] <<JSON>> {
      port "File I/O" as local_io
    }
    
    component [Google Drive] <<Cloud>> {
      port "Drive API" as drive_api
    }
    
    component [Drive Service] <<Adapter>> {
      port "Auth" as auth
    }
  }
}

cloud "Google Cloud Platform" {
  component [Drive API v3] <<Service>>
  component [OAuth 2.0] <<Auth>>
}

' UI connections
[Web UI] --> rest_api
[Desktop UI] --> desktop_port

' API to Core
rest_api --> handlers
handlers --> db_ops
handlers --> validation

' Core relationships
db_ops --> [Database]
[Database] --> [Table]
[Table] --> [TypeValidator]
[Operations] --> [Table]

' Persistence connections
[Database] --> local_io
handlers --> drive_api
drive_api --> auth
auth --> [Drive Service]

' Google Cloud connections
[Drive Service] ..> [OAuth 2.0] : authenticate
[Drive Service] ..> [Drive API v3] : upload/download

note right of [Operations]
  Union tables (Variant 58)
end note

note bottom of [TypeValidator]
  date, dateInvl types
end note

note top of [Google Drive]
  Service Account auth
  JSON file storage
end note

@enduml