@startuml activity
!theme plain
title TDMS - Activity Diagram: Database Operations with Google Drive

start

:User opens TDMS application;

partition "Database Management" {
  if (Load existing database?) then (yes)
    if (From Google Drive?) then (yes)
      :Authenticate with Google;
      :List available JSON files;
      :Select file from Drive;
      :Download and load database;
    else (local)
      :Select local JSON file;
      :Load database from file;
    endif
  else (create new)
    :Enter database name;
    :Create empty database;
  endif
}

:Database active;

partition "Table Operations" {
  switch (Select operation)
  case (Create Table)
    :Enter table name;
    :Define columns with types;
    note right
      Types: integer, real, char,
      string, date, dateInvl
    end note
    :Validate schema;
    :Create table;
  case (Insert Row)
    :Select table;
    :Enter values for each column;
    :Validate types;
    :Insert row;
  case (Union Tables)
    :Select first table;
    :Select second table;
    :Check schema compatibility;
    if (Schemas compatible?) then (yes)
      :Perform union;
      :Create result table;
    else (no)
      :Show incompatibility error;
    endif
  case (Drop Table)
    :Select table;
    :Confirm deletion;
    :Remove table;
  endswitch
}

partition "Save Operations" {
  if (Save to Google Drive?) then (yes)
    :Serialize database to JSON;
    :Upload to Google Drive;
    :Get file ID;
    :Show success with ID;
  else (local)
    :Serialize database to JSON;
    :Save to local file;
    :Show save location;
  endif
}

stop

@enduml